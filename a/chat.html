<style>*{font-family:system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;}.c,b{font-family:cursive;}</style>
<h2 class="c">Chatroom</h2>
<p>currently named <b id="x"></b></p>
<div id="chatBox">
</div>
<br>
<input name="msg" placeholder="Say something..." autocomplete="off">
<button onclick="send()">Send</button>
<iframe name="hiddenFrame" style="display:none;"></iframe>
<script>
let name="";function yay(){name=prompt("Enter your name");if(name.trim()===""||name===false){yay()}document.getElementById("x").innerText=name};yay();
let url = "https://api.jsonstorage.net/v1/json/7ec5df05-e3fd-4115-a2b7-4e72d46f3149/4b85069c-430d-402a-a08a-40eecc37ca29";
function escapeHTML(str){
    var p = document.createElement("p");
    p.appendChild(document.createTextNode(str));
    return p.innerHTML;
}
async function ref() {
    const res = await fetch(url);
    const data = await res.json();
    const msgs = data.record.messages || [];
    const chatBox = document.getElementById("chatBox");
    chatBox.innerHTML = msgs.slice(-20).map(m => `<b>${escapeHTML(m.name)}:</b> ${escapeHTML(m.text)}`).join("<br>");
    chatBox.scrollTop = chatBox.scrollHeight;
}
async function send() {
    const text = document.getElementById("msg").value;
    if(!text) return;
    
    const res = await fetch(url);
    const data = await res.json();
    const messages = data.record.messages || [];
    messages.push({name, text});
    
    await fetch(url+"?apiKey=ed5d2270-5dac-4811-b221-82b445f097a7", {
        method: "PUT",
        body: JSON.stringify({messages})
    });
    
    document.getElementById("msg").value = "";
    ref();
}
setInterval(ref, 1000);
</script>
